openapi: 3.0.3
info:
  title: Babysitter Matching Platform API
  description: |
    REST API for connecting parents with babysitters.
    Supports both web and telephony (IVR/AI) channels.
    
    ## Authentication
    All authenticated endpoints require a valid JWT token in the Authorization header:
    `Authorization: Bearer <token>`
    
    ## Response Format
    All responses follow this structure:
    ```json
    {
      "success": true,
      "data": { ... },
      "message": "Optional message"
    }
    ```
    
    Error responses:
    ```json
    {
      "success": false,
      "error": "Error description"
    }
    ```
  version: 1.0.0
  contact:
    name: API Support

servers:
  - url: http://localhost:3001/api
    description: Development server
  - url: https://api.example.com/api
    description: Production server

tags:
  - name: Auth
    description: Authentication (OTP-based)
  - name: Users
    description: User management
  - name: Parents
    description: Parent profiles
  - name: Babysitters
    description: Babysitter profiles
  - name: Guardians
    description: Guardian (parent supervisor) management
  - name: Locations
    description: Cities and neighborhoods
  - name: Jobs
    description: Job requests and matching
  - name: Bookings
    description: Confirmed bookings
  - name: Telephony
    description: IVR/AI telephony integration
  - name: Community Styles
    description: Community categorization

paths:
  # ==========================================
  # Authentication
  # ==========================================
  /auth/send-otp:
    post:
      tags: [Auth]
      summary: Send OTP to phone number
      description: Initiates authentication by sending a one-time password to the provided phone number
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [phone]
              properties:
                phone:
                  type: string
                  description: Phone number in E.164 format
                  example: "+972501234567"
      responses:
        '200':
          description: OTP sent successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OtpSentResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '429':
          description: Too many requests (rate limited)

  /auth/verify-otp:
    post:
      tags: [Auth]
      summary: Verify OTP and get JWT token
      description: Verifies the OTP code and returns a JWT token for authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [phone, code]
              properties:
                phone:
                  type: string
                  example: "+972501234567"
                code:
                  type: string
                  description: 6-digit OTP code
                  example: "123456"
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          description: Invalid or expired OTP

  /auth/me:
    get:
      tags: [Auth]
      summary: Get current user
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Current user data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout user
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Logged out successfully

  # ==========================================
  # User Registration
  # ==========================================
  /users/register/parent:
    post:
      tags: [Users]
      summary: Register as parent
      description: Creates a new parent account with profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ParentRegistrationRequest'
      responses:
        '201':
          description: Parent registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ParentRegistrationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: Phone number already registered

  /users/register/babysitter:
    post:
      tags: [Users]
      summary: Register as babysitter
      description: Creates a new babysitter account with profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BabysitterRegistrationRequest'
      responses:
        '201':
          description: Babysitter registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BabysitterRegistrationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: Phone number already registered

  # ==========================================
  # Parent Profile
  # ==========================================
  /users/parent/{userId}:
    get:
      tags: [Parents]
      summary: Get parent profile
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: Parent profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ParentProfileResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags: [Parents]
      summary: Update parent profile
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/UserId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ParentProfileUpdate'
      responses:
        '200':
          description: Profile updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ParentProfileResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  # ==========================================
  # Babysitter Profile
  # ==========================================
  /users/babysitter/{userId}:
    get:
      tags: [Babysitters]
      summary: Get babysitter profile
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: Babysitter profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BabysitterProfileResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags: [Babysitters]
      summary: Update babysitter profile
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/UserId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BabysitterProfileUpdate'
      responses:
        '200':
          description: Profile updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BabysitterProfileResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  # ==========================================
  # Guardian Management
  # ==========================================
  /guardians/link:
    post:
      tags: [Guardians]
      summary: Link guardian to babysitter
      description: Creates a guardian relationship for babysitter supervision
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LinkGuardianRequest'
      responses:
        '201':
          description: Guardian linked successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuardianResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /guardians/{guardianId}/verify:
    post:
      tags: [Guardians]
      summary: Verify guardian
      description: Guardian confirms their supervision role via OTP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [code]
              properties:
                code:
                  type: string
                  example: "123456"
      responses:
        '200':
          description: Guardian verified
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuardianResponse'

  /guardians/babysitter/{babysitterId}:
    get:
      tags: [Guardians]
      summary: Get guardian for babysitter
      security:
        - BearerAuth: []
      parameters:
        - name: babysitterId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Guardian details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuardianResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /guardians/{guardianId}/approve/{candidateId}:
    post:
      tags: [Guardians]
      summary: Guardian approves job request
      description: Guardian approves a specific job request for their babysitter
      security:
        - BearerAuth: []
      parameters:
        - name: guardianId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: candidateId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Request approved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestCandidateResponse'

  /guardians/{guardianId}/decline/{candidateId}:
    post:
      tags: [Guardians]
      summary: Guardian declines job request
      security:
        - BearerAuth: []
      parameters:
        - name: guardianId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: candidateId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Request declined
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestCandidateResponse'

  # ==========================================
  # Locations
  # ==========================================
  /locations/cities:
    get:
      tags: [Locations]
      summary: Get all cities
      responses:
        '200':
          description: List of cities
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CitiesResponse'

  /locations/cities/{cityId}/neighborhoods:
    get:
      tags: [Locations]
      summary: Get neighborhoods in a city
      parameters:
        - name: cityId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of neighborhoods
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NeighborhoodsResponse'

  # ==========================================
  # Community Styles
  # ==========================================
  /community-styles:
    get:
      tags: [Community Styles]
      summary: Get all community styles
      description: Returns admin-defined community categorizations
      responses:
        '200':
          description: List of community styles
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommunityStylesResponse'

  /community-styles/{id}:
    get:
      tags: [Community Styles]
      summary: Get community style by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Community style details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommunityStyleResponse'

  # ==========================================
  # Job Requests
  # ==========================================
  /requests:
    post:
      tags: [Jobs]
      summary: Create new job request
      description: Parent creates a new babysitting request
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRequestInput'
      responses:
        '201':
          description: Request created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /requests/{id}:
    get:
      tags: [Jobs]
      summary: Get request by ID
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Request details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /requests/parent/{parentId}:
    get:
      tags: [Jobs]
      summary: Get parent's requests
      security:
        - BearerAuth: []
      parameters:
        - name: parentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
      responses:
        '200':
          description: Paginated list of requests
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedRequestsResponse'

  /requests/{requestId}/candidates:
    get:
      tags: [Jobs]
      summary: Get candidates for request
      description: Returns matched babysitters for a specific request
      security:
        - BearerAuth: []
      parameters:
        - name: requestId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of candidates
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CandidatesResponse'

  /requests/{requestId}/select:
    post:
      tags: [Jobs]
      summary: Select babysitter for request
      description: Parent selects a babysitter from candidates
      security:
        - BearerAuth: []
      parameters:
        - name: requestId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [babysitter_id]
              properties:
                babysitter_id:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Booking created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingResponse'

  /requests/{requestId}/cancel:
    post:
      tags: [Jobs]
      summary: Cancel request
      security:
        - BearerAuth: []
      parameters:
        - name: requestId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Request cancelled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestResponse'

  # ==========================================
  # Babysitter Requests
  # ==========================================
  /babysitter/{babysitterId}/pending-requests:
    get:
      tags: [Babysitters]
      summary: Get pending requests for babysitter
      security:
        - BearerAuth: []
      parameters:
        - name: babysitterId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of pending request candidates
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CandidatesResponse'

  /babysitter/requests/{candidateId}/accept:
    post:
      tags: [Babysitters]
      summary: Babysitter accepts request
      security:
        - BearerAuth: []
      parameters:
        - name: candidateId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Request accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestCandidateResponse'

  /babysitter/requests/{candidateId}/decline:
    post:
      tags: [Babysitters]
      summary: Babysitter declines request
      security:
        - BearerAuth: []
      parameters:
        - name: candidateId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Request declined
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RequestCandidateResponse'

  /babysitter/{babysitterId}/bookings/upcoming:
    get:
      tags: [Babysitters]
      summary: Get babysitter's upcoming bookings
      security:
        - BearerAuth: []
      parameters:
        - name: babysitterId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of upcoming bookings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingsListResponse'

  # ==========================================
  # Bookings
  # ==========================================
  /bookings/{id}:
    get:
      tags: [Bookings]
      summary: Get booking by ID
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Booking details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingResponse'

  /bookings/parent/{parentId}:
    get:
      tags: [Bookings]
      summary: Get parent's bookings
      security:
        - BearerAuth: []
      parameters:
        - name: parentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
      responses:
        '200':
          description: Paginated list of bookings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedBookingsResponse'

  /bookings/babysitter/{babysitterId}:
    get:
      tags: [Bookings]
      summary: Get babysitter's bookings
      security:
        - BearerAuth: []
      parameters:
        - name: babysitterId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
      responses:
        '200':
          description: Paginated list of bookings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedBookingsResponse'

  /bookings/{bookingId}/start:
    post:
      tags: [Bookings]
      summary: Start booking
      description: Babysitter marks arrival
      security:
        - BearerAuth: []
      parameters:
        - name: bookingId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Booking started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingResponse'

  /bookings/{bookingId}/complete:
    post:
      tags: [Bookings]
      summary: Complete booking
      security:
        - BearerAuth: []
      parameters:
        - name: bookingId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Booking completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingResponse'

  /bookings/{bookingId}/cancel:
    post:
      tags: [Bookings]
      summary: Cancel booking
      security:
        - BearerAuth: []
      parameters:
        - name: bookingId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [reason]
              properties:
                reason:
                  type: string
                  example: "Schedule conflict"
      responses:
        '200':
          description: Booking cancelled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingResponse'

  /bookings/{bookingId}/rate:
    post:
      tags: [Bookings]
      summary: Rate babysitter
      description: Parent rates the babysitter after booking completion
      security:
        - BearerAuth: []
      parameters:
        - name: bookingId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [rating]
              properties:
                rating:
                  type: integer
                  minimum: 1
                  maximum: 5
                review:
                  type: string
                  maxLength: 500
      responses:
        '200':
          description: Rating added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingResponse'

  # ==========================================
  # Matching Engine
  # ==========================================
  /matching/find/{requestId}:
    post:
      tags: [Jobs]
      summary: Trigger matching for request
      description: |
        Finds suitable babysitters based on:
        - Service area / neighborhood
        - Availability
        - Age requirements
        - Community style preference
      security:
        - BearerAuth: []
      parameters:
        - name: requestId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Matching completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      candidates_count:
                        type: integer

  /matching/preferences:
    get:
      tags: [Jobs]
      summary: Get matching preferences
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Matching preferences
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      areas:
                        type: array
                        items:
                          type: string
                      age_range:
                        type: object
                        properties:
                          min:
                            type: integer
                          max:
                            type: integer

  # ==========================================
  # Telephony (IVR/AI)
  # ==========================================
  /telephony/incoming-call:
    post:
      tags: [Telephony]
      summary: Handle incoming call
      description: Webhook endpoint for IVR system to handle incoming calls
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TelephonyIncomingCall'
      responses:
        '200':
          description: Call handling instructions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TelephonyResponse'

  /telephony/collect-input:
    post:
      tags: [Telephony]
      summary: Collect DTMF input
      description: Webhook for collecting user input during IVR flow
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TelephonyInputEvent'
      responses:
        '200':
          description: Next IVR action
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TelephonyResponse'

  /telephony/complete-job:
    post:
      tags: [Telephony]
      summary: Complete job via phone
      description: Finalize a job request made via IVR
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                call_id:
                  type: string
                session_data:
                  type: object
      responses:
        '200':
          description: Job completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TelephonyResponse'

  /telephony/call-status/{candidateId}:
    get:
      tags: [Telephony]
      summary: Get call status
      security:
        - BearerAuth: []
      parameters:
        - name: candidateId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Call status
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      status:
                        type: string
                        enum: [PENDING, CALLING, COMPLETED, NO_ANSWER, FAILED]
                      attempts:
                        type: integer

  /telephony/retry/{candidateId}:
    post:
      tags: [Telephony]
      summary: Retry call to candidate
      security:
        - BearerAuth: []
      parameters:
        - name: candidateId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Retry initiated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from /auth/verify-otp

  parameters:
    UserId:
      name: userId
      in: path
      required: true
      schema:
        type: string
        format: uuid

    Page:
      name: page
      in: query
      schema:
        type: integer
        minimum: 1
        default: 1

    PerPage:
      name: per_page
      in: query
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 10

  responses:
    BadRequest:
      description: Invalid request parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    Unauthorized:
      description: Missing or invalid authentication
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    Forbidden:
      description: Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

  schemas:
    # ==========================================
    # Common Schemas
    # ==========================================
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: "Error description"

    PaginationMeta:
      type: object
      properties:
        total:
          type: integer
        page:
          type: integer
        per_page:
          type: integer
        total_pages:
          type: integer

    # ==========================================
    # Enums
    # ==========================================
    UserRole:
      type: string
      enum: [PARENT, BABYSITTER, GUARDIAN, ADMIN]

    UserStatus:
      type: string
      enum: [PENDING, ACTIVE, SUSPENDED, DELETED]

    RequestStatus:
      type: string
      enum: [NEW, MATCHING, PENDING_RESPONSES, PENDING_SELECTION, PENDING_PAYMENT, CONFIRMED, COMPLETED, CANCELLED]

    BookingStatus:
      type: string
      enum: [CONFIRMED, IN_PROGRESS, COMPLETED, CANCELLED]

    PaymentStatus:
      type: string
      enum: [PENDING, PAID, REFUNDED, FAILED]

    CandidateCallStatus:
      type: string
      enum: [PENDING, CALLING, COMPLETED, NO_ANSWER, FAILED]

    CandidateResponse:
      type: string
      enum: [PENDING, INTERESTED, DECLINED, GUARDIAN_PENDING, GUARDIAN_APPROVED, GUARDIAN_DECLINED]

    ApprovalMode:
      type: string
      enum: [AUTO_APPROVE, APPROVE_EACH_REQUEST, APPROVE_NEW_FAMILIES]

    Language:
      type: string
      enum: [hebrew, english, russian, french, spanish, arabic, amharic, yiddish]

    # ==========================================
    # User Schemas
    # ==========================================
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        type:
          $ref: '#/components/schemas/UserRole'
        phone:
          type: string
        email:
          type: string
          format: email
        status:
          $ref: '#/components/schemas/UserStatus'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    # ==========================================
    # Auth Schemas
    # ==========================================
    OtpSentResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            expires_in:
              type: integer
              description: Seconds until OTP expires
              example: 300

    AuthResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            token:
              type: string
              description: JWT token
            user:
              $ref: '#/components/schemas/User'

    UserResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/User'

    # ==========================================
    # Parent Schemas
    # ==========================================
    ParentProfile:
      type: object
      properties:
        user_id:
          type: string
          format: uuid
        full_name:
          type: string
        address:
          type: string
        city:
          type: string
        area:
          type: string
        children_ages:
          type: array
          items:
            type: integer
        household_notes:
          type: string
        community_style_id:
          type: string
          format: uuid
        languages:
          type: array
          items:
            $ref: '#/components/schemas/Language'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ParentRegistrationRequest:
      type: object
      required: [phone, full_name, address, city, neighborhood, children_ages]
      properties:
        phone:
          type: string
          example: "+972501234567"
        full_name:
          type: string
          example: "שרה כהן"
        email:
          type: string
          format: email
        address:
          type: string
          example: "רחוב הרצל 15"
        city:
          type: string
          example: "תל אביב"
        neighborhood:
          type: string
          example: "רמת אביב"
        children_ages:
          type: array
          items:
            type: integer
          example: [3, 5, 8]
        household_notes:
          type: string
          example: "יש כלב קטן"
        community_style_id:
          type: string
          format: uuid
        languages:
          type: array
          items:
            $ref: '#/components/schemas/Language'
          example: ["hebrew", "english"]

    ParentRegistrationResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            user:
              $ref: '#/components/schemas/User'
            profile:
              $ref: '#/components/schemas/ParentProfile'

    ParentProfileResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/ParentProfile'

    ParentProfileUpdate:
      type: object
      properties:
        full_name:
          type: string
        email:
          type: string
          format: email
        address:
          type: string
        city:
          type: string
        area:
          type: string
        children_ages:
          type: array
          items:
            type: integer
        household_notes:
          type: string
        community_style_id:
          type: string
          format: uuid
        languages:
          type: array
          items:
            $ref: '#/components/schemas/Language'

    # ==========================================
    # Babysitter Schemas
    # ==========================================
    AvailabilitySlot:
      type: object
      properties:
        day_of_week:
          type: integer
          minimum: 0
          maximum: 6
          description: 0=Sunday, 6=Saturday
        start_time:
          type: string
          pattern: '^([01]?[0-9]|2[0-3]):[0-5][0-9]$'
          example: "14:00"
        end_time:
          type: string
          pattern: '^([01]?[0-9]|2[0-3]):[0-5][0-9]$'
          example: "22:00"

    BabysitterProfile:
      type: object
      properties:
        user_id:
          type: string
          format: uuid
        full_name:
          type: string
        age:
          type: integer
        service_areas:
          type: array
          items:
            type: string
        availability:
          type: array
          items:
            $ref: '#/components/schemas/AvailabilitySlot'
        experience_years:
          type: integer
        community_style_id:
          type: string
          format: uuid
        guardian_id:
          type: string
          format: uuid
        guardian_required_approval:
          type: boolean
        approval_mode:
          $ref: '#/components/schemas/ApprovalMode'
        rating:
          type: number
          format: float
          minimum: 0
          maximum: 5
        total_reviews:
          type: integer
        bio:
          type: string
        languages:
          type: array
          items:
            $ref: '#/components/schemas/Language'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    BabysitterRegistrationRequest:
      type: object
      required: [phone, full_name, age, service_areas, experience_years, city, neighborhood, walking_radius_minutes]
      properties:
        phone:
          type: string
          example: "+972501234567"
        full_name:
          type: string
          example: "נועה לוי"
        email:
          type: string
          format: email
        age:
          type: integer
          minimum: 14
          maximum: 99
          example: 17
        service_areas:
          type: array
          items:
            type: string
          example: ["רמת אביב", "רמת החייל"]
        experience_years:
          type: integer
          minimum: 0
          example: 2
        community_style_id:
          type: string
          format: uuid
        bio:
          type: string
          maxLength: 500
        has_guardian:
          type: boolean
          example: true
        guardian_phone:
          type: string
          example: "+972501234568"
        guardian_name:
          type: string
          example: "רחל לוי"
        approval_mode:
          $ref: '#/components/schemas/ApprovalMode'
        city:
          type: string
          example: "תל אביב"
        neighborhood:
          type: string
          example: "רמת אביב"
        walking_radius_minutes:
          type: integer
          minimum: 5
          maximum: 60
          example: 15
        languages:
          type: array
          items:
            $ref: '#/components/schemas/Language'
          example: ["hebrew", "english"]

    BabysitterRegistrationResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            user:
              $ref: '#/components/schemas/User'
            profile:
              $ref: '#/components/schemas/BabysitterProfile'

    BabysitterProfileResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/BabysitterProfile'

    BabysitterProfileUpdate:
      type: object
      properties:
        full_name:
          type: string
        age:
          type: integer
        service_areas:
          type: array
          items:
            type: string
        availability:
          type: array
          items:
            $ref: '#/components/schemas/AvailabilitySlot'
        experience_years:
          type: integer
        community_style_id:
          type: string
          format: uuid
        bio:
          type: string
        approval_mode:
          $ref: '#/components/schemas/ApprovalMode'
        languages:
          type: array
          items:
            $ref: '#/components/schemas/Language'

    # ==========================================
    # Guardian Schemas
    # ==========================================
    Guardian:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        full_name:
          type: string
        phone:
          type: string
        preferred_channel:
          type: string
          enum: [PHONE, WEB, BOTH]
        verified:
          type: boolean
        created_at:
          type: string
          format: date-time

    LinkGuardianRequest:
      type: object
      required: [babysitter_id, phone, name]
      properties:
        babysitter_id:
          type: string
          format: uuid
        phone:
          type: string
          example: "+972501234568"
        name:
          type: string
          example: "רחל לוי"

    GuardianResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/Guardian'

    # ==========================================
    # Location Schemas
    # ==========================================
    City:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: "תל אביב"

    Neighborhood:
      type: object
      properties:
        id:
          type: string
          format: uuid
        city_id:
          type: string
          format: uuid
        name:
          type: string
          example: "רמת אביב"

    CitiesResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/City'

    NeighborhoodsResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/Neighborhood'

    # ==========================================
    # Community Style Schemas
    # ==========================================
    CommunityStyle:
      type: object
      properties:
        id:
          type: string
          format: uuid
        label:
          type: string
          example: "חילוני"
        description:
          type: string
        active:
          type: boolean

    CommunityStylesResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/CommunityStyle'

    CommunityStyleResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/CommunityStyle'

    # ==========================================
    # Request Schemas
    # ==========================================
    Request:
      type: object
      properties:
        id:
          type: string
          format: uuid
        parent_id:
          type: string
          format: uuid
        datetime_start:
          type: string
          format: date-time
        datetime_end:
          type: string
          format: date-time
        area:
          type: string
        address:
          type: string
        children_ages:
          type: array
          items:
            type: integer
        requirements:
          type: string
        min_babysitter_age:
          type: integer
        max_babysitter_age:
          type: integer
        community_style_id:
          type: string
          format: uuid
        status:
          $ref: '#/components/schemas/RequestStatus'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateRequestInput:
      type: object
      required: [datetime_start, datetime_end, area, children_ages]
      properties:
        datetime_start:
          type: string
          format: date-time
        datetime_end:
          type: string
          format: date-time
        area:
          type: string
        address:
          type: string
        children_ages:
          type: array
          items:
            type: integer
        requirements:
          type: string
        min_babysitter_age:
          type: integer
        max_babysitter_age:
          type: integer
        community_style_id:
          type: string
          format: uuid

    RequestResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/Request'

    PaginatedRequestsResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/Request'
            total:
              type: integer
            page:
              type: integer
            per_page:
              type: integer
            total_pages:
              type: integer

    # ==========================================
    # Candidate Schemas
    # ==========================================
    RequestCandidate:
      type: object
      properties:
        id:
          type: string
          format: uuid
        request_id:
          type: string
          format: uuid
        babysitter_id:
          type: string
          format: uuid
        call_status:
          $ref: '#/components/schemas/CandidateCallStatus'
        call_attempts:
          type: integer
        response:
          $ref: '#/components/schemas/CandidateResponse'
        babysitter_responded_at:
          type: string
          format: date-time
        guardian_responded_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        # Extended fields for display
        babysitter:
          $ref: '#/components/schemas/BabysitterProfile'

    RequestCandidateResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/RequestCandidate'

    CandidatesResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/RequestCandidate'

    # ==========================================
    # Booking Schemas
    # ==========================================
    Booking:
      type: object
      properties:
        id:
          type: string
          format: uuid
        request_id:
          type: string
          format: uuid
        parent_id:
          type: string
          format: uuid
        babysitter_id:
          type: string
          format: uuid
        datetime_start:
          type: string
          format: date-time
        datetime_end:
          type: string
          format: date-time
        address:
          type: string
        status:
          $ref: '#/components/schemas/BookingStatus'
        payment_status:
          $ref: '#/components/schemas/PaymentStatus'
        payment_amount:
          type: number
          format: float
        confirmed_at:
          type: string
          format: date-time
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
        parent_rating:
          type: integer
          minimum: 1
          maximum: 5
        parent_review:
          type: string
        babysitter_rating:
          type: integer
          minimum: 1
          maximum: 5
        created_at:
          type: string
          format: date-time

    BookingResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/Booking'

    BookingsListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/Booking'

    PaginatedBookingsResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/Booking'
            total:
              type: integer
            page:
              type: integer
            per_page:
              type: integer
            total_pages:
              type: integer

    # ==========================================
    # Telephony Schemas
    # ==========================================
    TelephonyIncomingCall:
      type: object
      properties:
        call_id:
          type: string
        from_phone:
          type: string
        to_phone:
          type: string
        timestamp:
          type: string
          format: date-time

    TelephonyInputEvent:
      type: object
      properties:
        call_id:
          type: string
        dtmf_input:
          type: string
          description: User's keypad input (e.g., "1" for interested, "2" for decline)
        session_id:
          type: string
        timestamp:
          type: string
          format: date-time

    TelephonyResponse:
      type: object
      properties:
        action:
          type: string
          enum: [PLAY_MESSAGE, COLLECT_INPUT, TRANSFER, HANGUP]
        message:
          type: string
          description: Text-to-speech message or audio URL
        collect_options:
          type: object
          properties:
            max_digits:
              type: integer
            timeout_seconds:
              type: integer
        next_webhook:
          type: string
          description: URL for next callback

security:
  - BearerAuth: []
